<script>
  let tasks = [];

  // Load saved tasks from cookies or local storage
  function loadTasks() {
    const stored = getCookie("tasks");
    if (stored) {
      try {
        tasks = JSON.parse(stored);
        renderTasks();
      } catch (e) {
        console.error("Cookie parse error:", e);
      }
    }
  }

  // Save tasks to cookies or local storage
  function saveTasks() {
    setCookie("tasks", JSON.stringify(tasks), 30);
  }

  // Render tasks in the task list
  function renderTasks() {
    const taskList = document.getElementById("taskList");
    taskList.innerHTML = ""; // Clear the list

    tasks.forEach((task, index) => {
      const taskItem = document.createElement("div");
      taskItem.className = "task";
      taskItem.innerHTML = `
        <div class="task-header" onclick="toggleTaskDetails(${index})">üìù ${task.desc}</div>
        <div class="task-details" id="taskDetails${index}">
          <p><strong>Due Date:</strong> ${task.due}</p>
          <p><strong>Priority:</strong> ${task.priority}</p>
          <button onclick="deleteTask(${index})" style="background-color: red;">üóëÔ∏è Delete Task</button>
        </div>
      `;
      taskList.appendChild(taskItem);
    });
  }

  // Add a new task
  function addTask(event) {
    event.stopPropagation(); // Prevent toggle on button click

    const desc = document.getElementById("taskDesc").value;
    const due = document.getElementById("taskDue").value;
    const priority = document.getElementById("taskPriority").value;

    if (!desc || !due) {
      alert("Please fill in all fields!");
      return;
    }

    tasks.push({ desc, due, priority });
    saveTasks();
    renderTasks();

    // Clear input fields
    document.getElementById("taskDesc").value = "";
    document.getElementById("taskDue").value = "";
    document.getElementById("taskPriority").value = "High";

    alert("‚úÖ Task added!");
  }

  // Delete a task
  function deleteTask(index) {
    tasks.splice(index, 1);
    saveTasks();
    renderTasks();
    alert("üóëÔ∏è Task deleted!");
  }

  // Toggle task details visibility
  function toggleTaskDetails(index) {
    const taskDetails = document.getElementById(`taskDetails${index}`);
    taskDetails.classList.toggle("open");
  }

  // Set a cookie
  function setCookie(name, value, days) {
    const expires = new Date(Date.now() + days * 86400000).toUTCString();
    document.cookie = `${name}=${encodeURIComponent(value)}; expires=${expires}; path=/`;
  }

  // Get a cookie
  function getCookie(name) {
    const cookies = document.cookie.split("; ");
    for (const c of cookies) {
      const [key, value] = c.split("=");
      if (key === name) return decodeURIComponent(value);
    }
    return null;
  }

  // Load tasks on page load
  window.addEventListener("DOMContentLoaded", loadTasks);
</script>

<!-- Task List -->
<div id="taskList"></div>

<!-- Add Task Button -->
<button onclick="addTask(event)">‚ûï Add Task</button>
